function d3StatesMap(){var A,a,r=0,p=0,v=[],f=[],l=[],u=[],k=["#e5b6ff","#5a0d84"],w=null,h=new Map(),n={top:10,right:10,bottom:10,left:10},B,z,d,m;var i=d3.dispatch("stateSelected","onState");var c=0;var g=0;var s=d3.scaleQuantize().range(d3.range(10)).domain([g,c]);var y=d3.scaleLinear().domain([0,10]).range(k);var x=d3.scaleLinear().domain([0,10]).range([0.5,2]);var b;var o;var q;var j;var e;function t(D){A="#"+D.attr("id");a=D.attr("id");D.each(function(){var G;d3.json("js/states-10m.json",function(I,H){if(I){throw I}G=topojson.feature(H,H.objects.states);B=d3.geoAlbersUsa().fitSize([r,p],G);q=d3.geoPath().projection(B);b=d3.zoom().on("zoom",F);o=D.append("svg").attr("preserveAspectRatio","xMidYMid meet").attr("viewBox","0 0 "+r+" "+p);j=o.append("g").attr("class","StateGroup");e=o.append("g").attr("class","ConnectionGroup");j.selectAll(".State").data(G.features).enter().append("path").attr("class","State").attr("d",q).attr("id",function(J){return"cpath-"+J.id}).style("stroke","var(--color-plain)").style("stroke-width","0.8").style("fill","var(--color-accent-off)").style("cursor","").style("transition","0.3s").style("opacity","0.3");d3.select(A).append("div").attr("class",a+"-ToolTip").style("display","none").style("border-radius","5px").style("padding","8px").style("z-index","50").style("font","300 14px helvetica").style("font-family","'RobotoL', helvetica").style("background-color","rgba(0,0,0,0.8)").style("border","0px white solid").style("color","var(--color-onplain)")})});function E(K){d3.event.preventDefault();d3.event.stopPropagation();var H=d3.zoomTransform(o.node());var O=H.invert(d3.mouse(this));var P=B.invert(O);if(w==K.id){d()}else{w=K.id;var G=q.bounds(K),Q=G[1][0]-G[0][0],N=G[1][1]-G[0][1],M=(G[0][0]+G[1][0])/2,L=(G[0][1]+G[1][1])/2,J=Math.max(1,Math.min(15,0.9/Math.max(Q/r,N/p))),I=[r/2-J*M,p/2-J*L];o.transition().delay(0).duration(1500).call(b.transform,d3.zoomIdentity.translate(I[0],I[1]).scale(J))}}function F(){j.attr("transform",d3.event.transform);e.attr("transform",d3.event.transform)}function C(G){G.on("mouseenter",function(H){d3.select(A).select("."+a+"-ToolTip").html(H.data[category]+": "+d3.format(".3s")(H.data[variable])+" ("+parseInt((H.data[variable]/sumTotal)*100)+"%)").style("display","inline-block").style("position","fixed").style("left",(d3.event.pageX+20)+"px").style("top",(d3.event.pageY-0)+"px")});G.on("mouseout",function(H){d3.select(A).select("."+a+"-ToolTip").html("").style("display","none")})}d=function(){w=null;o.transition().delay(0).duration(10).call(b.transform,d3.zoomIdentity.translate(0,0).scale(1))};z=function(G){var I=d3.geoCircle();if(G){d()}h.clear();c=d3.max(v,function(J){if(J.count>0){h.set(J.id,J)}return J.count});g=d3.min(v,function(J){return J.count});s=d3.scaleQuantize().range(d3.range(100)).domain([g,c]);y=d3.scaleLinear().domain([0,100]).range(k);let heatselect=j.selectAll(".State");heatselect.each(function(K,J){if(h.has(K.id)){d3.select(this).on("mouseover",function(){d3.select(A).select("."+a+"-ToolTip").html(K.properties.name+": "+h.get(K.id).info).style("display","inline-block").style("position","fixed").style("left",(d3.event.pageX+20)+"px").style("top",(d3.event.pageY-0)+"px")}).on("mouseleave",function(){d3.select(A).select("."+a+"-ToolTip").html("").style("display","none")}).transition().duration(300).style("opacity","1").style("stroke-width","0.8").style("fill",function(){return y(s(h.get(K.id).count))}).style("stroke","var(--color-plain)").style("cursor","default")}else{d3.select(this).on("mouseover",function(){d3.select(A).select("."+a+"-ToolTip").html(K.properties.name).style("display","inline-block").style("position","fixed").style("left",(d3.event.pageX+20)+"px").style("top",(d3.event.pageY-0)+"px")}).on("mouseleave",function(){d3.select(A).select("."+a+"-ToolTip").html("").style("display","none")}).transition().duration(300).style("opacity","0.3").style("stroke-width","0.8").style("fill","var(--color-accent-off)").style("stroke","var(--color-plain)").style("cursor","default")}});c=d3.max(f,function(J){return J.count});g=d3.min(f,function(J){return J.count});s=d3.scaleQuantize().range(d3.range(10)).domain([g,c]);x=d3.scaleLinear().domain([0,10]).range([2,8.5]);var H=e.selectAll(".connections").data(f,function(J){return J.id});H.enter().append("path").on("mouseover",function(J){tooltip.html(J.location+" "+h.get(J.id).info)}).on("mouseleave",function(){tooltip.html("")}).on("click",function(K,J){i.call("connectionSelected",this,J)}).attr("d",function(J){return q(I.center([J.lon,J.lat]).radius(2)())}).attr("fill","var(--color-geo-access)").attr("strokeiwidth","0.5").attr("stroke","rgba(50,50,50,0.3)").attr("cursor","pointer").attr("class","connections").attr("transition","0.5s").attr("opacity","0").transition().delay(function(K,J){return 100*J}).duration(1500).attr("opacity","0.5").transition().duration(1500).attr("d",function(J){return q(I.center([J.lon,J.lat]).radius(x(s(J.count)))())}).attr("cursor","pointer").attr("opacity","0.5");H.merge(H).on("mouseover",function(J){tooltip.html(J.location+" "+J.info)}).on("mouseleave",function(){tooltip.html("")}).on("click",function(K,J){i.call("connectionSelected",this,J)}).transition().duration(100).delay(function(K,J){return 100*J}).attr("opacity","0").attr("d",function(J){return q(I.center([J.lon,J.lat]).radius(0)())}).transition().duration(1500).attr("d",function(J){return q(I.center([J.lon,J.lat]).radius(2)())}).attr("opacity","0.5").transition().duration(1500).attr("d",function(J){return q(I.center([J.lon,J.lat]).radius(x(s(J.count)))())});H.exit().transition().duration(600).attr("d",function(J){return q(I.center([J.lon,J.lat]).radius(0.01)())}).attr("opacity",0).delay(500).remove()}}t.width=function(C){if(!arguments.length){return r}r=C;return t};t.height=function(C){if(!arguments.length){return p}p=C;return t};t.colorRange=function(C){if(!arguments.length){return k}k=C;return t};t.data=function(C){if(!arguments.length){return v}v=[];f=[];if(C.heatmap){v=C.heatmap}if(C.locations){f=C.locations}return t};t.resetZoom=function(){if(typeof d==="function"){d()}return t};t.updateMap=function(C){if(typeof z==="function"){z(C)}return t};t.on=function(){var C=i.on.apply(i,arguments);return C===i?t:C};return t};